<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8"> 
	
	<link rel="stylesheet" href="style.css">
	
	<!-- Nécessaire pour wkhtmltopdf -->
	<style>
	  img.emoji {
		  height: 1em;
		  width: 1em;
		  /* margin: 0 .05em 0 .1em; */
		  vertical-align: -0.1em;
	  }
	</style>
	<!-- 
	<script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
		 <script>window.onload = function () { twemoji.parse(document.body); }</script>

		 DEFER / ASYNC ???
    -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		 
	<script src="scripts/google_calendar.js"></script>
	<script src="scripts/formatter.js"></script>
	<!-- TODO remove -->
	<script src="scripts/strip_tags.js"></script>
    
    <script>
	 async function loadCalendar() {
		 startDate = $("#start_date").val();
		 endDate = $("#end_date").val();
		 events = await loadCalendarsEvents(startDate, endDate);

		 // TODO
		 month = "Mars";
		 page = $(`<page>
	  <header>
        <month>${month}</month>

        <img src="imgs/internet-icon_blue.svg" style="width: 15px; height: 15px;" />
		quartiergenereux.fr
		<br>

		<img src="imgs/facebook-icon_blue.svg" style="width: 15px; height: 15px;" />
		<img src="imgs/instagram-icon_blue.svg" style="width: 15px; height: 15px;" />
		QG.montpellier
	  </header>

    </page>
		`);
		 page.appendTo("body");

		 eventsListFormatter = new EventsGroupedByDateListFormatter();
		 //eventsListFormatter = new EventsListFormatter();
		 eventsHTML = eventsListFormatter.format(events);
		 page.append(eventsHTML.join(""));

         $("month").on("click", createEditableTag("<month>"));
         $("name").on("click", createEditableTag("<name>"));
         $("description").on("click", createEditableTag("<description>"));
	 }
	 
     function createEditableTag(tag) {
         function tagClicked() {
             let divHtml = $(this).html();
             let editableText = $("<textarea />");
             editableText.val(divHtml);
             $(this).replaceWith(editableText);
             editableText.focus();
             // setup the blur event for this new textarea
             editableText.blur(editableTextBlurred);
         }
		 
		 function editableTextBlurred() {
			 let html = $(this).val();
			 let viewableText = $(tag);
			 viewableText.html(html);
			 $(this).replaceWith(viewableText);
			 // setup the click event for this new div
			 viewableText.click(tagClicked);
		 }
		 
         return tagClicked;
     }
	 
     $(document).ready(function() {
		 $("#generate_calendar").on("click", loadCalendar);
		 $("#print_button").on("click", function () { window.print(); });
     });
    </script>

	<script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
	
  </head>
  
  <body>
	  <formulaire>
		  Veuillez indiquer la plage de date recherchée pour générer l'agenda :<br>
		  
		  Date de début : <input id="start_date" type="date" /><br>
		  Date de fin : <input id="end_date" type="date" /><br>
		  <input id="generate_calendar" type="button" value="Générer" />
		  <input id="print_button" type="button" value="Imprimer / Sauvegarder en PDF" />
	  </formulaire>
  </body>
</html>
